<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ institution.name }} | Origen Consulting</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <style>
        /* Animatsiya va hover effektlari */
        @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .hover-scale { transition: transform 0.3s ease; }
        .hover-scale:hover { transform: scale(1.02); }

        /* Video container */
        .video-container { position: relative; padding-bottom: 56.25%; height:0; overflow:hidden; cursor:pointer; }
        .video-container iframe,
        .video-container video { position:absolute; top:0; left:0; width:100%; height:100%; }

        /* Modal */
        .video-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index:1000; justify-content:center; align-items:center; opacity:0; transition:opacity 0.3s ease; }
        .video-modal.active { display:flex; opacity:1; }
        .modal-content { position: relative; width: 80%; max-width: 900px; }
        .close-modal { position:absolute; top:-40px; right:0; color:white; font-size:2rem; cursor:pointer; transition: all 0.3s ease; }
        .close-modal:hover { color:#2ecc71; }
        .video-iframe-container { position:relative; width:100%; padding-top:56.25%; }
        .video-iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; border-radius:8px; }
    </style>
</head>
<body class="bg-gray-50">

<header class="bg-gradient-to-r from-blue-700 to-blue-500 text-white shadow-md">
    <div class="container mx-auto px-6 py-4 flex items-center justify-between">
        <a href="{% url 'countries_list' %}" class="flex items-center text-white hover:text-blue-200 transition">
            <i class="fas fa-arrow-left mr-2"></i>
            <span>Orqaga</span>
        </a>
        <div class="text-sm opacity-80">Origen Consulting</div>
    </div>
</header>

<main class="container mx-auto px-6 py-8 max-w-4xl">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden animate-fade-in">
        <!-- Header Image -->
        <div class="relative">
            {% if institution.image_url %}
            <img src="{{ institution.image_url }}" alt="{{ institution.name }}" class="w-full h-64 object-cover hover-scale">
            {% else %}
            <div class="w-full h-64 bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center">
                <i class="fas fa-university text-white text-6xl"></i>
            </div>
            {% endif %}
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6">
                <h1 class="text-3xl md:text-4xl font-bold text-white">{{ institution.name }}</h1>
                <div class="flex items-center mt-2">
                    <i class="fas fa-map-marker-alt text-white/80 mr-2"></i>
                    <span class="text-white/90">{{ institution.country.name }}</span>
                </div>
            </div>
        </div>

        <div class="p-6 md:p-8">
            <div class="prose max-w-none">
                {{ institution.description|linebreaks }}
            </div>

            {% if institution.advantages %}
            <div class="mt-8 bg-green-50 border-l-4 border-green-500 p-4 rounded-r">
                <div class="flex items-start">
                    <i class="fas fa-star text-green-500 mt-1 mr-3"></i>
                    <div>
                        <h3 class="font-semibold text-green-800 mb-1">Afzalliklari</h3>
                        <p class="text-green-700">{{ institution.advantages }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Video Section -->
            {% if institution.video_url %}
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-video mr-2 text-blue-500"></i>
                    Video material
                </h3>
                <div class="video-container rounded-lg shadow-md overflow-hidden" data-video-url="{{ institution.video_url }}">
                    {% if institution.video_url|slice:"-4:" == ".mp4" %}
                    <video controls class="w-full">
                        <source src="{{ institution.video_url }}" type="video/mp4">
                        Sizning brauzeringiz video tagini qo'llab-quvvatlamaydi.
                    </video>
                    {% else %}
                    <img src="https://placehold.co/600x400/3498db/white?text=Video" alt="Video preview" class="w-full h-full object-cover cursor-pointer">
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Programs Section -->
            <div class="bg-gray-50 p-4 rounded-lg mt-8">
                <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                    <i class="fas fa-book-open mr-2"></i>
                    Ta'lim dasturlari
                </h4>
                {% if institution.programs %}
                <ul class="space-y-2">
                    {% for program in institution.programs %}
                    <li class="flex items-start">
                        <i class="fas fa-graduation-cap text-gray-500 mt-1 mr-2"></i>
                        <span>{{ program }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-gray-500">Ma'lumot mavjud emas</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <div class="mt-8 text-center">
        <a href="{% url 'countries_list' %}" class="inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg shadow-md hover:bg-gray-700 hover:shadow-lg transition-all duration-300">
            <i class="fas fa-arrow-left mr-2"></i>
            Davlatlar ro'yxatiga qaytish
        </a>
    </div>
</main>

<!-- Video Modal -->
<div class="video-modal" id="videoModal">
    <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <div class="video-iframe-container">
            <iframe class="video-iframe" id="videoFrame" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</div>

<footer class="bg-gray-800 text-white py-6 mt-12">
    <div class="container mx-auto px-6 text-center">
        <p>&copy; {% now "Y" %} Origen Consulting. Barcha huquqlar himoyalangan.</p>
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const videoContainers = document.querySelectorAll('.video-container');
    const videoModal = document.getElementById('videoModal');
    const videoFrame = document.getElementById('videoFrame');
    const closeModal = document.getElementById('closeModal');

    videoContainers.forEach(container => {
        container.addEventListener('click', function() {
            const videoUrl = this.getAttribute('data-video-url');
            if (!videoUrl) return;

            let embedUrl = videoUrl;

            // YouTube
            if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                let videoId;
                if (videoUrl.includes('youtube.com')) {
                    videoId = videoUrl.split('v=')[1].split('&')[0];
                } else {
                    videoId = videoUrl.split('/').pop();
                }
                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
            }
            // Vimeo
            else if (videoUrl.includes('vimeo.com')) {
                const videoId = videoUrl.split('/').pop();
                embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
            }
            // Instagram (iframe ishlamaydi, embed kod ishlatish)
            else if (videoUrl.includes('instagram.com')) {
                embedUrl = videoUrl + 'embed';
            }

            videoFrame.src = embedUrl;
            videoModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    });

    closeModal.addEventListener('click', function() {
        videoModal.classList.remove('active');
        videoFrame.src = '';
        document.body.style.overflow = 'auto';
    });

    videoModal.addEventListener('click', function(e) {
        if (e.target === videoModal) closeModal.click();
    });
});
</script>

</body>
</html>