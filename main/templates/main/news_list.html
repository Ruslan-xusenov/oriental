{% extends "base.html" %}
{% load static %}

{% block content %}

<section id="news" class="bg-gray-50 py-16" aria-labelledby="news-heading">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-12">
            <div class="mb-6 md:mb-0">
                <h2 id="news-heading" class="text-3xl font-bold text-gray-800">So'nggi Yangiliklar</h2>
                <p class="text-gray-600">Universitet hayotidagi eng muhim voqealar</p>
            </div>
            <a href="{% url 'news_list' %}" class="flex items-center text-blue-600 hover:text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded">
                Barcha yangiliklar
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <span class="sr-only">Barcha yangiliklarni ko'rish</span>
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for item in latest_news %}
            <article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-500 transform hover:-translate-y-2 focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-offset-2" itemscope itemtype="https://schema.org/NewsArticle">
                {% if item.image %}
                <div class="relative h-48 overflow-hidden">
                    <img 
                        src="{{ item.image.url }}" 
                        alt="{{ item.title }}" 
                        class="w-full h-full object-cover transition duration-700 hover:scale-105"
                        loading="lazy"
                        width="400"
                        height="240"
                        itemprop="image"
                    >
                    <div class="absolute top-4 right-4 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                        {{ item.category|default:"Yangilik" }}
                    </div>
                </div>
                {% elif item.image_url %}
                <div class="relative h-48 overflow-hidden">
                    <img 
                        src="{{ item.image_url }}" 
                        alt="{{ item.title }}" 
                        class="w-full h-full object-cover transition duration-700 hover:scale-105"
                        loading="lazy"
                        width="400"
                        height="240"
                        itemprop="image"
                    >
                    <div class="absolute top-4 right-4 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                        {{ item.category|default:"Yangilik" }}
                    </div>
                </div>
                {% endif %}

                
                <div class="p-6" itemprop="articleBody">
                    <div class="flex items-center text-sm text-gray-500 mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                        </svg>
                        <time datetime="{{ item.created_at|date:'c' }}" itemprop="datePublished">
                            {{ item.created_at|date:"d F Y" }}
                        </time>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-3" itemprop="headline">
                        <a href="{% url 'news_detail' item.pk %}" class="hover:text-blue-600 focus:outline-none" itemprop="url">
                            {{ item.title }}
                        </a>
                    </h3>
                    <p class="text-gray-600 mb-4" itemprop="description">
                        {{ item.content|striptags|truncatewords:20 }}
                    </p>
                </div>
            </article>
            {% empty %}
            <div class="col-span-full text-center py-12">
                <p class="text-gray-500">Hozircha yangiliklar mavjud emas</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>

<script src="https://kit.fontawesome.com/{{ FONT_AWESOME_KIT_ID }}.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.12.0/intersection-observer.js"></script>

<script>
const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

if (prefersReducedMotion) {
    const styles = document.createElement('style');
    styles.textContent = `
        [class*="animate-"] {
            animation: none !important;
            transition: none !important;
        }
    `;
    document.head.appendChild(styles);
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const initParticles = () => {
        if (document.getElementById('particles-js') && typeof particlesJS === 'function') {
            particlesJS('particles-js', {
                particles: {
                    number: { 
                        value: prefersReducedMotion ? 30 : 80, 
                        density: { 
                            enable: true, 
                            value_area: prefersReducedMotion ? 400 : 800 
                        } 
                    },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { 
                        value: 0.5, 
                        random: true,
                        anim: { enable: !prefersReducedMotion }
                    },
                    size: { 
                        value: 3, 
                        random: true,
                        anim: { enable: !prefersReducedMotion }
                    },
                    line_linked: { 
                        enable: true, 
                        distance: 150, 
                        color: "#ffffff", 
                        opacity: 0.4, 
                        width: 1 
                    },
                    move: { 
                        enable: !prefersReducedMotion,
                        speed: 2, 
                        direction: "none", 
                        random: true, 
                        straight: false, 
                        out_mode: "out" 
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { 
                            enable: !prefersReducedMotion, 
                            mode: "repulse" 
                        },
                        onclick: { 
                            enable: !prefersReducedMotion, 
                            mode: "push" 
                        }
                    }
                }
            });
        }
    };

    if (!prefersReducedMotion) {
        const particlesScript = document.createElement('script');
        particlesScript.src = 'https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js';
        particlesScript.onload = initParticles;
        document.head.appendChild(particlesScript);
    }

    const smoothScroll = (targetId, offset = 100) => {
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
            const offsetPosition = targetPosition - offset;

            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });

            setTimeout(() => {
                targetElement.setAttribute('tabindex', '-1');
                targetElement.focus();
                targetElement.removeAttribute('tabindex');
            }, 1000);
        }
    };

    document.body.addEventListener('click', (e) => {
        if (e.target.closest('a[href^="#"]')) {
            e.preventDefault();
            const targetId = e.target.closest('a').getAttribute('href');
            if (targetId !== '#') {
                smoothScroll(targetId);
            }
        }
    });

    const animateCounters = () => {
        const counters = document.querySelectorAll('.animate-count');
        if (!counters.length) return;

        const duration = 2000;
        const startTime = performance.now();

        const updateCounters = (timestamp) => {
            const progress = Math.min((timestamp - startTime) / duration, 1);
            
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const start = 0;
                const current = Math.floor(progress * (target - start) + start);
                counter.textContent = current.toLocaleString();
            });

            if (progress < 1) {
                requestAnimationFrame(updateCounters);
            }
        };

        requestAnimationFrame(updateCounters);
    };

    const initIntersectionObserver = () => {
        const elementsToObserve = document.querySelectorAll('section, .animate-count');
        
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fade-in-up');
                        
                        if (entry.target.classList.contains('animate-count')) {
                            animateCounters();
                        }
                        
                        observer.unobserve(entry.target);
                    }
                });
            }, { 
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px' 
            });

            elementsToObserve.forEach(element => {
                observer.observe(element);
            });
        } else {
            elementsToObserve.forEach(element => {
                element.classList.add('animate-fade-in-up');
                if (element.classList.contains('animate-count')) {
                    animateCounters();
                }
            });
        }
    };

    initIntersectionObserver();
});
</script>

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "EducationalOrganization",
    "name": "Origen Consulting",
    "description": "Xalqaro standartdagi ta'lim va innovatsion tadqiqotlar markazi",
    "url": "{{ request.build_absolute_uri }}",
    "logo": "{% static 'images/logo.png' %}",
    "foundingDate": "1995",
    "address": {
        "@type": "PostalAddress",
        "addressCountry": "Uzbekistan"
    },
    "sameAs": [
        "https://facebook.com/orientaluniversity",
        "https://twitter.com/orientaluni",
        "https://instagram.com/orientaluniversity"
    ]
}
</script>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        scroll-behavior: smooth;
        --scrollbar-thumb: #3b82f6;
        --scrollbar-track: #f1f1f1;
    }
    
    @supports (scrollbar-width: thin) {
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
        }
    }
    
    @supports selector(::-webkit-scrollbar) {
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
    }
    
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
            scroll-behavior: auto !important;
        }
    }
    
    @keyframes fade-in-up {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slide-in {
        from {
            transform: translateX(-100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes wave {
        0% {
            transform: translateX(0);
        }
        100% {
            transform: translateX(-50%);
        }
    }
    
    .animate-fadeIn {
        animation: fade-in-up 0.8s ease-out forwards;
    }
    
    .animate-slideIn {
        animation: slide-in 0.6s ease-out forwards;
    }
    
    .animate-wave {
        animation: wave 10s linear infinite;
    }
    
    .animate-fade-in-up {
        animation: fade-in-up 0.8s ease-out forwards;
    }
    
    .focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
    
    @media print {
        .no-print {
            display: none !important;
        }
        
        body {
            background: white !important;
            color: black !important;
        }
        
        a::after {
            content: " (" attr(href) ")";
            font-size: 0.8em;
            font-weight: normal;
        }
    }
</style>
{% endblock %}